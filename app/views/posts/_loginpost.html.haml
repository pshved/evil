-# the name of the form is used in post.js tag editor!  Do not change!
= form_for @loginpost, :html => {:name => 'postform'} do |f|
  = f.hidden_field :reply_to
  -# Error messages for the validated post
  - if @loginpost.saved_post && @loginpost.saved_post.errors.any?
    %div#error_explanation
      %h2="#{pluralize(@loginpost.saved_post.errors.count, "error")} prohibited this post from being saved:"
      %ul
        - @loginpost.saved_post.errors.full_messages.each do |msg|
          %li=msg
  -# Error messages for the login form
  - if @loginpost.session && @loginpost.session.errors.any?
    %div#error_explanation
      %h2="#{pluralize(@loginpost.session.errors.count, "error")} prohibited this post from being saved:"
      %ul
        - @loginpost.session.errors.full_messages.each do |msg|
          %li=msg
  -# Other error messages (are there any?)
  - if @loginpost.errors.any?
    %div#error_explanation
      %h2="#{pluralize(@loginpost.errors.count, "error")} prohibited this post from being saved:"
      %ul
        - @loginpost.errors.full_messages.each do |msg|
          %li=msg
  %table{:border=>0, :cellspacing => 0, :cellpadding => 3}
    %tr
      %td{:colspan => 2, :align => "center"}
        %big
          %a{:name => 'reply'}Reply
    %tr
      %td{:colspan => 2}
        %hr{:align => 'center', :width => '80%', :noshade => true}
    %tr
      %td{:align => 'center'}
        %b Name:
      - if current_user
        %td{:align => 'left'}
          %span.postform-login= current_user.login
          %span.postform-logout=link_to 'Log out', logout_path
      - else
        = f.fields_for :session do |sf|
          %td{:align => 'left'}
            =sf.text_field 'login', :size => 22
            %b Password:
            =sf.password_field 'password', :size => 22
            %b Autologin:
            -# Note that this is not "remember me" session attribute.  It's whether we log in or just use the credentials for one-time posting.  Note the f instead of sf!
            =f.check_box 'autologin'
    %tr
      %td{:align => 'center'}Topic:
      %td
        =f.text_field 'title', :size => 88
    %tr
      %td{:colspan => 2}
        - buttons = [%w(b i u q pic url h s sup sub strike), %w(color red pre center tex tub spoiler hr smile)]
        - buttons.each do |row|
          - row.each do |btn|
            = render :partial => 'posts/button', :locals => {:button => btn}
          %br/
        = render :partial => 'posts/smiles'
    %tr
      %td{:colspan => 2, :align => :center}
        -# Older browsers may not support getElementById... so KISS me!
        =f.text_area 'body', :cols => 75, :rows => 12, :onfocus => "last = document.getElementById('loginpost_body');"

  -# Display captcha
  - if !current_user && captcha_enabled
    =t :'recaptcha.prompt'
    = captcha_tags
  = f.submit 'Preview'
  = f.submit

